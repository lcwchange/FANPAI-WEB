<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç¿»ç‰Œç½‘ï¼ˆæµ‹è¯•ä¸­ï¼‰</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: sans-serif; background:#f2f4f8; padding:1rem; }
    h1 { text-align:center; margin-bottom:1rem; color:#333; }
    #actions { text-align:center; margin-bottom:1rem; }
    .btn { padding:0.6rem 1.2rem; margin:0 0.5rem; background:#007aff; color:#fff; border:none; border-radius:6px; cursor:pointer; }
    .btn:disabled { background:#ccc; cursor:not-allowed; }
    #grid { display:grid; grid-template-columns:repeat(2,1fr); gap:1rem; max-width:600px; margin:0 auto 1rem; }
    .card { perspective:800px; cursor:pointer; }
    .inner { position:relative; width:100%; padding-top:133%; transition:transform .6s; transform-style:preserve-3d; }
    .flipped { transform:rotateY(180deg); }
    .face { position:absolute; top:0; left:0; width:100%; height:100%; backface-visibility:hidden; border-radius:10px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.1); display:flex; align-items:center; justify-content:center; font-size:1.2rem; color:#fff; }
    .front  { background:#666; }
    .back   { background:#fff; transform:rotateY(180deg); flex-direction:column; color:#333; padding:1rem; text-align:center; }
    .back img { width:60px; height:60px; border-radius:50%; margin-bottom:0.5rem; }
    #pager { text-align:center; margin-bottom:1rem; }
    #registerForm { max-width:400px; margin:1rem auto 2rem; padding:1rem; background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    #registerForm input { width:100%; padding:0.5rem; margin:0.5rem 0; border:1px solid #ccc; border-radius:4px; }
    #registerForm button { width:100%; margin-top:0.5rem; }
    #registerMsg { text-align:center; color:red; margin-top:0.5rem; }
  </style>
</head>
<body>

  <h1>ç¿»ç‰Œç½‘</h1>

  <!-- ç”¨æˆ·æ³¨å†Œè¡¨å• -->
  <form id="registerForm">
    <h2 style="text-align:center; margin-bottom:1rem; color:#007aff;">æ³¨å†Œè´¦å·</h2>
    <input type="text" id="username" placeholder="ç”¨æˆ·å" required />
    <input type="password" id="password" placeholder="å¯†ç " required />
    <button type="submit" class="btn">æ³¨å†Œ</button>
    <div id="registerMsg"></div>
  </form>

  <div id="actions">
    <button class="btn" id="shareBtn">ğŸš€ åˆ†äº«è§£é”ç¿»é¡µ</button>
    <button class="btn" id="vipBtn">ğŸŒŸ æˆä¸ºä¼šå‘˜</button>
    <span id="status" style="margin-left:1rem;">æœªè§£é”ç¿»é¡µï¼Œéä¼šå‘˜</span>
  </div>

  <div id="grid"></div>

  <div id="pager">
    <button class="btn" id="prevBtn" disabled>ä¸Šä¸€é¡µ</button>
    <span id="pageInfo"></span>
    <button class="btn" id="nextBtn" disabled>ä¸‹ä¸€é¡µ</button>
  </div>

  <script>
    // åç«¯æ¥å£åœ°å€ï¼šè¯·ç¡®ä¿ä½ çš„ Flask åç«¯ /register è·¯ç”±å·²å°±ç»ª
    const BACKEND_REGISTER = 'http://43.143.121.17:5000/register';

    // æ³¨å†ŒåŠŸèƒ½
    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const msgEl = document.getElementById('registerMsg');
      msgEl.textContent = '';
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value.trim();
      if (!username || !password) {
        msgEl.textContent = 'ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º';
        return;
      }
      try {
        const res = await fetch(BACKEND_REGISTER, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({username, password})
        });
        const data = await res.json();
        if (data.status === 'success') {
          msgEl.style.color = 'green';
          msgEl.textContent = 'æ³¨å†ŒæˆåŠŸï¼';
          e.target.reset();
        } else {
          msgEl.style.color = 'red';
          msgEl.textContent = data.message || 'æ³¨å†Œå¤±è´¥';
        }
      } catch (err) {
        msgEl.style.color = 'red';
        msgEl.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åå†è¯•';
        console.error(err);
      }
    });

    // ==== ç¿»ç‰ŒåŠŸèƒ½å‚æ•°è®¾ç½® ====
    const TOTAL_CARDS = 250;
    const PAGE_SIZE = 4;
    let currentPage = 1, isUnlocked = false, isVip = false, balance = 0;

    const cards = Array.from({length: TOTAL_CARDS}, (_,i)=>({
      id: i+1, img: (i%50)+1,
      name: `ç”¨æˆ·${i+1}`, intro: `è¿™æ˜¯ç”¨æˆ·${i+1}çš„ç®€ä»‹`
    }));

    const grid = document.getElementById('grid');
    const pageInfo = document.getElementById('pageInfo');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shareBtn = document.getElementById('shareBtn');
    const vipBtn   = document.getElementById('vipBtn');
    const statusEl = document.getElementById('status');

    function renderPage() {
      grid.innerHTML = '';
      const start = (currentPage-1)*PAGE_SIZE;
      cards.slice(start, start+PAGE_SIZE).forEach(card=>{
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div class="inner" data-id="${card.id}">
            <div class="face front">${card.id}</div>
            <div class="face back">
              <img src="https://i.pravatar.cc/100?img=${card.img}" alt="">
              <div>${card.name}</div>
              <div style="font-size:.9rem;color:#666;">${card.intro}</div>
            </div>
          </div>`;
        div.onclick = () => onFlip(div.querySelector('.inner'));
        grid.appendChild(div);
      });
      pageInfo.textContent = `ç¬¬ ${currentPage}/${Math.ceil(TOTAL_CARDS/PAGE_SIZE)} é¡µ`;
      prevBtn.disabled = currentPage===1;
      nextBtn.disabled = !isUnlocked || currentPage===Math.ceil(TOTAL_CARDS/PAGE_SIZE);
    }

    function onFlip(inner) {
      if (isVip) {
        inner.classList.toggle('flipped');
      } else {
        if (balance <= 0) {
          if (confirm('éä¼šå‘˜ç¿»ç‰Œéœ€æ”¯ä»˜ 1 å…ƒï¼Œæ˜¯å¦æ”¯ä»˜ï¼Ÿ')) {
            balance -= 1;
            alert('æ”¯ä»˜æˆåŠŸï¼Œå‰©ä½™ä½™é¢ ' + balance + ' å…ƒ');
            inner.classList.toggle('flipped');
          }
        } else {
          inner.classList.toggle('flipped');
        }
      }
    }

    prevBtn.onclick = () => { if (currentPage>1) currentPage--, renderPage(); };
    nextBtn.onclick = () => { if (currentPage<Math.ceil(TOTAL_CARDS/PAGE_SIZE)) currentPage++, renderPage(); };
    shareBtn.onclick = () => { isUnlocked = true; statusEl.textContent = isVip?'ä¼šå‘˜çŠ¶æ€ï¼Œå·²è§£é”å…¨éƒ¨åŠŸèƒ½':'å·²åˆ†äº«ï¼Œè§£é”ç¿»é¡µ'; renderPage(); };
    vipBtn.onclick   = () => { isVip=true; balance=Infinity; isUnlocked=true; statusEl.textContent='ä¼šå‘˜çŠ¶æ€ï¼Œå…è´¹ç¿»é¡µç¿»ç‰Œ'; renderPage(); };

    renderPage();
  </script>

</body>
</html>
